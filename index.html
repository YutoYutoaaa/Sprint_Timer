<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>写真判定WEBアプリ</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div id="app">
    <header class="header">
      <h1 class="title">写真判定WEBアプリ</h1>
    </header>
    <main class="main">
      <div class="video-container">
        <video id="video" class="video" preload="metadata"></video>
        <div class="controls">
          <input type="file" id="fileInput" accept="video/*" class="file-input">
          <button id="playPauseBtn" class="btn">再生</button>
          <span id="timeDisplay" class="time-display">00:00.00</span>
        </div>
      </div>
    </main>
  </div>
  <script src="js/app.js"></script>
</body>
</html>

:root {
  --primary-color: #007AFF;
  --bg-color: #f5f5f5;
  --font-color: #333;
  --btn-bg: #fff;
  --btn-border: #ddd;
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
  background: var(--bg-color);
  color: var(--font-color);
  display: flex;
  justify-content: center;
  align-items: flex-start;
  min-height: 100vh;
  padding: 20px;
}

#app {
  width: 100%;
  max-width: 400px;
}

.header .title {
  text-align: center;
  margin-bottom: 16px;
}

.video-container {
  position: relative;
  background: #000;
  border-radius: 8px;
  overflow: hidden;
}

.video {
  width: 100%;
  display: block;
}

.controls {
  display: flex;
  align-items: center;
  padding: 8px;
  background: var(--btn-bg);
  border: 1px solid var(--btn-border);
  border-top: none;
}

.file-input {
  flex: 1;
}

.btn {
  margin-left: 8px;
  padding: 8px 12px;
  background: var(--primary-color);
  color: #fff;
  border: none;
  border-radius: 4px;
  font-size: 1rem;
  cursor: pointer;
}

.time-display {
  margin-left: auto;
  font-variant-numeric: tabular-nums;
  font-size: 1rem;
}

(() => {
  'use strict';

  class VideoController {
    /**
     * @param {HTMLVideoElement} videoEl
     * @param {HTMLInputElement} fileInputEl
     * @param {HTMLButtonElement} playPauseBtnEl
     * @param {HTMLElement} timeDisplayEl
     */
    constructor({ videoEl, fileInputEl, playPauseBtnEl, timeDisplayEl }) {
      this.videoEl = videoEl;
      this.fileInputEl = fileInputEl;
      this.playPauseBtnEl = playPauseBtnEl;
      this.timeDisplayEl = timeDisplayEl;
      this.init();
    }

    init() {
      this.fileInputEl.addEventListener('change', (e) => this.handleFileSelect(e));
      this.playPauseBtnEl.addEventListener('click', () => this.togglePlayPause());
      this.videoEl.addEventListener('timeupdate', () => this.updateTimeDisplay());
      this.videoEl.addEventListener('loadedmetadata', () => this.updateTimeDisplay());
      this.videoEl.addEventListener('error', (e) => this.handleError(e));
    }

    handleFileSelect(event) {
      const file = event.target.files[0];
      if (!file) return;
      const url = URL.createObjectURL(file);
      this.videoEl.src = url;
      this.videoEl.load();
      this.playPauseBtnEl.textContent = '再生';
    }

    togglePlayPause() {
      if (this.videoEl.paused) {
        this.videoEl.play()
          .then(() => { this.playPauseBtnEl.textContent = '停止'; })
          .catch((err) => console.error('Playback error:', err));
      } else {
        this.videoEl.pause();
        this.playPauseBtnEl.textContent = '再生';
      }
    }

    updateTimeDisplay() {
      const t = this.videoEl.currentTime || 0;
      this.timeDisplayEl.textContent = this.formatTime(t);
    }

    formatTime(seconds) {
      const mm = Math.floor(seconds / 60);
      const ss = Math.floor(seconds % 60);
      const cs = Math.floor((seconds - mm * 60 - ss) * 100);
      return `${mm.toString().padStart(2, '0')}:` +
             `${ss.toString().padStart(2, '0')}.` +
             `${cs.toString().padStart(2, '0')}`;
    }

    handleError(event) {
      console.error('Video error:', event);
      alert('動画の読み込み中にエラーが発生しました。別のファイルをお試しください。');
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    new VideoController({
      videoEl: document.getElementById('video'),
      fileInputEl: document.getElementById('fileInput'),
      playPauseBtnEl: document.getElementById('playPauseBtn'),
      timeDisplayEl: document.getElementById('timeDisplay'),
    });
  });
})();

